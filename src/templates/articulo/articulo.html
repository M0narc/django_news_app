{% extends "base.html" %}

{% block title %}
    {{ articulo.titulo }} - Tecnoticias
{% endblock %}

{% block content %}
<div class="articulo">
    <h1>{{ articulo.titulo }}</h1>
    <p><strong>Autor:</strong> {{ articulo.autor }}</p>
    <p><strong>Fecha de Publicación:</strong> {{ articulo.fecha_publicada }}</p>
    <div class="contenido">
        {{ articulo.contenido|linebreaks }}
    </div>
    <p><strong>Categoría:</strong> {{ articulo.categoria.nombre }}</p>
</div>

<!-- Botones de Editar y Eliminar (si es el autor o colaborador) -->
{% if request.user == articulo.autor or es_colaborador_o_admin %}
    <div class="botones-articulo">
        <a href="{% url 'editar_articulo' articulo.slug %}" class="btn btn-primary">Editar</a>
        
        <form method="POST" action="{% url 'eliminar_articulo' articulo.slug %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger" onclick="return confirm('¿Estás seguro de que deseas eliminar este artículo?');">Eliminar</button>
        </form>
    </div>
{% endif %}

<!-- Sección de comentarios -->
<div class="comentarios">
    <h2>Comentarios</h2>
    
    <!-- Lista de comentarios -->
    {% for comentario in comentarios %}
        <div class="comentario">
            <p><strong>{{ comentario.autor }}</strong> el {{ comentario.fecha_publicada }}</p>
            <p>{{ comentario.contenido }}</p>

            <!-- Opciones para editar/eliminar comentario si es el autor o colaborador/admin -->
            {% if request.user == comentario.autor or es_colaborador_o_admin %}
                <a href="?editar={{ comentario.id }}" class="btn btn-secondary btn-sm">Editar</a>
                <form method="POST" action="{% url 'eliminar_comentario' articulo.slug %}" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="comentario_id" value="{{ comentario.id }}">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de que deseas eliminar este comentario?');">Eliminar</button>
                </form>
            {% endif %}
        </div>
    {% empty %}
        <p>No hay comentarios aún. ¡Sé el primero en comentar!</p>
    {% endfor %}
</div>

<!-- Formulario de comentarios -->
<div class="formulario-comentario">
    <h3>Agregar un comentario</h3>

    {% if comentario_en_edicion %}
        <h4>Estás editando tu comentario</h4>
    {% endif %}

    <form method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        
        {% if comentario_en_edicion %}
            <input type="hidden" name="comentario_id" value="{{ comentario_en_edicion.id }}">
            <button type="submit" class="btn btn-primary">Actualizar Comentario</button>
        {% else %}
            <button type="submit" class="btn btn-primary">Publicar Comentario</button>
        {% endif %}
    </form>
</div>

{% endblock %}
