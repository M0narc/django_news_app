{% extends "base.html" %}

{% block title %}
    {{ articulo.titulo }} - Tecnoticias
{% endblock %}

{% block content %}
<div class="articulo">
    <h1>{{ articulo.titulo }}</h1>
    <p><strong>Autor:</strong> {{ articulo.autor }}</p>
    <p><strong>Fecha de Publicación:</strong> {{ articulo.fecha_publicada }}</p>
    <div class="contenido">
        {{ articulo.contenido|linebreaks }}
    </div>
    <p><strong>Categoría:</strong> {{ articulo.categoria.nombre }}</p>
</div>

<!-- Sección de comentarios -->
<div class="comentarios">
    <h2>Comentarios</h2>
    
    {% if comentarios %}
        <ul>
            {% for comentario in comentarios %}
                <li style="margin-bottom: 20px;">
                    <strong>{{ comentario.autor }}</strong> 
                    {% if comentario.fecha_creacion %} 
                        ({{ comentario.fecha_creacion }}) 
                    {% endif %}:
                    <br>

                    {% if comentario == comentario_en_edicion %}
                        <!-- Mostrar formulario de edición solo si estamos editando este comentario -->
                        <form method="POST" action="{% url 'comentar_articulo' articulo.slug %}">
                            {% csrf_token %}
                            {{ form.as_p }}
                            <input type="hidden" name="comentario_id" value="{{ comentario.id }}">
                            <button type="submit">Guardar cambios</button>
                        </form>
                    {% else %}
                        <!-- Mostrar comentario normalmente -->
                        <p>{{ comentario.contenido }}</p>

                        {% if comentario.autor == user or es_colaborador_o_admin %}
                            <a href="{% url 'detalle_articulo' articulo.slug %}?editar={{ comentario.id }}">Editar</a>
                            <form method="POST" action="{% url 'eliminar_comentario' comentario.id %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit">Eliminar</button>
                            </form>
                        {% endif %}
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No hay comentarios aún.</p>
    {% endif %}
</div>

<!-- Formulario para añadir un comentario -->
<div class="agregar-comentario">
    {% if user.is_authenticated %}
        <h2>Añadir comentario</h2>
        <form method="POST" action="{% url 'comentar_articulo' articulo.slug %}">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Enviar comentario</button>
        </form>
    {% else %}
        <p><a href="{% url 'login' %}">Inicia sesión</a> para dejar un comentario.</p>
    {% endif %}
</div>
{% endblock %}

